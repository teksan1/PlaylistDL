#!/usr/bin/env python3
import subprocess
import json
from pathlib import Path

playlist_file = Path(__file__).parent / "soundcloud_playlist.json"

url = input("Enter SoundCloud playlist URL: ").strip()
print(f"[2026] üéß Scraping playlist for: {url}")
try:
    subprocess.run(
        ["yt-dlp", "--dump-json", "--ignore-errors", "--yes-playlist", "--no-warnings", url],
        text=True,
        check=True,
        capture_output=True
    )
except subprocess.CalledProcessError as e:
    print(f"[2026] ‚ùå Error scraping playlist: {e}")
    exit(1)

# Save results to JSON
# Note: yt-dlp --dump-json outputs multiple JSON objects, one per line
output_file = playlist_file
tracks = []
with subprocess.Popen(
    ["yt-dlp", "--dump-json", "--ignore-errors", "--yes-playlist", "--no-warnings", url],
    stdout=subprocess.PIPE, text=True
) as proc:
    for line in proc.stdout:
        try:
            tracks.append(json.loads(line))
        except json.JSONDecodeError:
            continue

with open(output_file, "w", encoding="utf-8") as f:
    json.dump(tracks, f, ensure_ascii=False, indent=2)

print(f"[2026] ‚úÖ {len(tracks)} tracks found. Saving to {output_file}")
